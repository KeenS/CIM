#!/bin/sh -
# This file is for load

cim(){
    command="$1"
    [ -n "$command" ] && shift
    case "$command" in
	install)
	    sh "$CIM_HOME/scripts/cim_install_impl" "$@" ;;
	use)
	    sh "$CIM_HOME/scripts/cim_use_impl" "$@";;
	resume)
		case "$1" in
		    rm)
			shift
			sh "$CIM_HOME/scripts/cim_resume" "rm" "$@" ;;
		    *)
			sh "$CIM_HOME/scripts/cim_resume" "resume" "$@" ;;
		esac;;
	reset)
	    sh "$CIM_HOME/scripts/cim_reset";;
	list)
	    case "$1" in
		install)
		    cat "$CIM_HOME/res/known" ;;
		resume)
		    find "$CIM_HOME/tmp/" -name 'resume-*' | sed -e 's/.*resume-//g';;
		use)
		    find "$CIM_HOME/bin/" -exec basename '{}' ';' | grep  '-';;
		*)
		    echo "Unknown subcommand '$1'. See 'cim help list'" >&2
		    return 1;;
	    esac
	    ;;
	help)
	    case "$1" in
		"")
		    cat "$CIM_HOME/res/help" ;;
		*)
		    if [ -s "$CIM_HOME/res/help_$1" ];then
			cat "$CIM_HOME/res/help_$1"
		    else
			echo "Help for $1 is not prepared, sorry." >&2
			return 1
		    fi
		    ;;
	    esac
	    ;;

	*)
	    if [ -n "$command" ]; then
		msg="[0;31mUnknown command '$command'.[0;39m"
	    else
		msg="[0;31mCommand not specified.[0;39m"
	    fi
	    cim help
	    echo $msg >&2
	    return 1;;
    esac
}
