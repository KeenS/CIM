#!/bin/sh -
# This file is for execute

set -ex

. "$CIM_HOME/scripts/cim_install_impl_lib"

cim_install_full="
cim_install_impl_start
cim_install_impl_download
cim_install_impl_expand
cim_install_impl_configure
cim_install_impl_make
cim_install_impl_install
cim_install_impl_finish
"
cim_install_sbcl_full="
cim_install_impl_start
cim_install_impl_download
cim_install_impl_expand
cim_install_sbcl_ensure_impl
cim_install_sbcl_make
cim_install_sbcl_install
cim_install_impl_finish
"

target=$1
shift
set --  `__cim_split_impl_version "$target"` "$@"
case "$target" in
    clisp*|gcl*|ecl*)
	processes="$cim_install_full"
	;;
    abcl*)
	
	;;
    sbcl*)
	processes="$cim_install_sbcl_full"
	;;
    ccl*)
	    
	;;
    *)
	echo "Unknown Lisp impl $1. Exit." >&2
	exit 1;
	;;
esac

printf "%s\n" $processes > "$CIM_HOME/tmp/resume-$1-$2"
for proc in $processes;do
    eval $proc "$@" && sed -i "/$proc/d" "$CIM_HOME/tmp/resume-$1-$2" ||
    exit 1
done
