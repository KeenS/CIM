#!/bin/sh
set -e
: ${CIM_HOME:="$HOME/.cim"};
export CIM_HOME;
mkdir -p "$CIM_HOME/archives";
mkdir -p "$CIM_HOME/tmp";
if which curl > /dev/null ; then
    download(){ curl -L "$1" }
elif which wget > /dev/null ;then
    download(){ wget "$1" -O - }
elif which fetch > /dev/null;then
    download(){ fetch "$1" -o -}
fi
download https://codeload.github.com/KeenS/CIM/tar.gz/master | gzip -cd - | tar xf - -C "$CIM_HOME/tmp";
mv "$CIM_HOME/tmp/CIM-master/"* "$CIM_HOME/";
for dir in archives bin cores impls lib quicklisp res scripts src sysets tmp
do
    mkdir -p "$CIM_HOME/$dir"
done;
ln -s "$CIM_HOME/scripts/cl" "$CIM_HOME/bin/cl";
cat <<EOF > "$CIM_HOME/init";
#!/bin/sh
: \${CIM_HOME:="$CIM_HOME"};
export CIM_HOME
PATH="\$CIM_HOME/bin:\$PATH";export PATH

. "\$CIM_HOME/scripts/cim"

EOF
cat <<EOM;
Adding to your .*rc file
'[ -s $HOME/.cim/init ] && . $HOME/.cim/init'
EOM
cimrc='[ -s $HOME/.cim/init ] && . $HOME/.cim/init'
if [ -n "$BASH_VERSION" ];then
    echo "$cimrc" >> .bashrc
fi
if [ -n "$ZSH_VERSION" ];then
    echo "$cimrc" >> .zshrc
fi
  
