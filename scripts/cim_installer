#!/bin/sh -
# This file is for execute
set -e
: ${CIM_HOME:="$HOME/.cim"};
export CIM_HOME
umask 077
mkdir -p "$CIM_HOME/archives"
mkdir -p "$CIM_HOME/tmp"
download(){
    if which curl > /dev/null 2>&1;then
	curl -L "$1"
    elif which wget > /dev/null 2>&1 ;then
	wget  -O - "$1"
    elif which fetch > /dev/null 2>&1;then
	fetch -o - "$1"
    fi
}

download https://codeload.github.com/KeenS/CIM/tar.gz/master | gzip -cd - | tar -xf - -C "$CIM_HOME/tmp"
mv -f "$CIM_HOME/tmp/CIM-master/"* "$CIM_HOME/" &&
rm -rf "$CIM_HOME/tmp/CIM-master/"
for dir in bin config impls src
do
    mkdir -p "$CIM_HOME/$dir"
done

for executable in cl ql cim
do
    rm -f "$CIM_HOME/bin/$executable"
    ln -s "$CIM_HOME/scripts/$executable" "$CIM_HOME/bin/$executable"
    chmod u+x "$CIM_HOME/scripts/$executable"
done
if expr match $SHELL '*csh' > /dev/null 2>&1 ;then
    cat <<EOM
Adding to your .`basename $SHELL`rc file
'if (-r "$CIM_HOME/init.csh" ) then
   source "$CIM_HOME/init.csh"
fi'
EOM
    rc='if (-r "$CIM_HOME/init.csh" ) then
   source "$CIM_HOME/init.csh"
endif
'
    case $SHELL in
	*/csh)  grep "$rc" "$HOME/.cshrc" || cat "$rc" >> "$HOME/.cshrc";;
	*/tcsh) grep "$rc" "$HOME/.tcshrc" || cat "$rc" >> "$HOME/.tcshrc";;
    esac
else
    cat <<EOM
Adding to your .`basename $SHELL`rc file
'[ -s $HOME/.cim/init.sh ] && . $HOME/.cim/init.sh'
EOM
    rc='[ -s "$HOME/.cim/init.sh" ] && . "$HOME/.cim/init.sh"'
    case $SHELL in
	*/bash) grep "$rc" "$HOME/.bashrc" || cat "$rc" >> "$HOME/.bashrc";;
	*/zsh)  grep "$rc" "$HOME/.zshrc" || cat "$rc" >> "$HOME/.zshrc";;
	*/sh)   grep "$rc" "$HOME/.profile" || cat "$rc" >> "$HOME/.profile";;
    esac
fi
